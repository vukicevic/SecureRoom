<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>SecureRoom</title>
  <link href="resources/style.css" media="all" rel="stylesheet" type="text/css">

  <script src="resources/external/crunch.js"></script>
  <script src="resources/utils.js"></script>
  <script src="resources/random.default.js"></script>
  <script src="resources/hash.sha1.js"></script>
  <script src="resources/symmetric.aes.cfb.js"></script>
  <script src="resources/asymmetric.rsa.js"></script>
  <script src="resources/secureroom.js"></script>
  <script src="resources/ui.js"></script>

  <script type="text/html" id="template-message">
    <li class="message{{class}}"><div class="time">{{time}}</div><p><b class="cln">{{sender}}</b>{{message}}</p>{{info}}</li>
  </script>
  <script type="text/html" id="template-message-info">
    <ul class="info hidden-height">{{#info}}<li><b class="cln">{{term}}</b>{{data}}</li>{{/info}}</ul>
  </script>
  <script type="text/html" id="template-key-alert">
    <li id="alert-{{id}}" class="alert"><div class="time">{{time}}</div><p class="join">{{name}}</p><div class="info">{{info}}<button>Accept</button>&nbsp;<button>Reject</button></div></li>
  </script>
  <script type="text/html" id="template-key-info">
    <p><b>{{sid}}</b><br><small>{{ssize}} BITS | {{sdate}}</small></p>
  </script>
  <script type="text/html" id="template-key-chain">
    <li id="key-{{id}}"><div class="export hidden"><textarea wrap="off">{{data}}</textarea></div><div class="controls"><span>ACTIVE</span><span>PUBLIC KEY</span></div><div class="info"><h3>{{name}}</h3>{{info}}</div></li>
  </script>
</head>
<body>
  <div id="menu">
    <span class="closed" id="sidebarToggle">
      <svg height="19" width="16" xmlns="http://www.w3.org/2000/svg" version="1.1">
        <rect y="3" width="16" height="3"></rect>
        <rect y="8" width="16" height="3"></rect>
        <rect y="13" width="16" height="3"></rect>
      </svg>
    </span>
    <span id="room">Room: -</span>
  </div>

  <aside id="sidebar">
    <dl>
      <dt class="section">Settings</dt>
      <dd>Change Server URL</dd>
      <dt class="section">User</dd>
      <dd id="mykey">
        <div class="export hidden"><textarea wrap="off"></textarea></div>
        <div class="export hidden"><textarea wrap="off"></textarea></div>
        <div id="mycontrols" class="controls"><span>PRIVATE KEY</span><span>PUBLIC KEY</span></div>
        <div id="myinfo" class="info"><h3 id="myname"></h3></div>
      </dd>
      <dt class="section">Keychain</li>
      <dd>
        <ul id="keychain"></ul>
      </dd>
    </dl>
  </aside>

  <ul id="content">
    <li class="alert" id="welcome">
      <input type="text" id="nickname" placeholder="Choose a name and key size" autocomplete="off"><select id="keysize" autocomplete="off" class="border-left"><option>1024</option><option>2048</option><option>4096</option></select><button id="generate" class="border-left">Generate</button>
    </li>
  </ul>

  <div id="input">
    <input type="text" id="message" autocomplete="off"><button id="send" class="border-left">Send</button>
  </div>

  <script>
  if (typeof window.WebSocket === "function" && typeof window.Worker === "function") {
    var primitives, secureroom;

    window.addEventListener("load", function() {
      primitives = new Primitives(),
      secureroom = new SecureRoom(
        function() { UI.createRoom(); UI.addWelcome("distribute"); UI.toggleRoom() },
        function() { UI.addWelcome("connect"); UI.toggleInput(false) },
        function() { UI.addWelcome("disconnect"); UI.toggleInput(true) },
        UI.addMessage,
        UI.addUser
      );

      UI.init();
    });

    window.addEventListener("resize", function() {
      UI.toggleKeychain()("close");
    });
  } else {
    alert("Your browser does not have the necessary features to run this application. Please try using the latest version of Firefox, Chrome or Internet Explorer.");
  }
  </script>
</body>
</html>