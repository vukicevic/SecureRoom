<html>
<head>
  <meta charset="utf-8"> 
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>SecureRoom Terminal</title>
  <style>
  	* {
   		padding: 0;
  		margin: 0;
	  }
    body {
  		background-color: black;
  		color: #bcefe6;
  		font-family: monospace;
      padding: 10px;
      text-shadow: 0 0 3px #bcefe6;
  	}
  	ul {
		  width:100%;
		  list-style-type: none;
  	}
    dl {
      white-space: pre;
    }
    dt {
      float: left;
    }
    dt:after {
      content: " nenad # ";
    }
    dl {
      float: left;
    }
    .cursor {
      height: 1em;
      width: 1em;
    }
    .highlight {
      background-color: #bcefe6;
      color: black;
      box-shadow: 0 0 3px #bcefe6;
    }
    .nofocus {
      background-color: transparent !important;
      color: #bcefe6 !important;
      box-shadow: 0 0 3px #bcefe6;
    }
  </style>
</head>
<body>
<!--pre>
#####################################################
#                                                   #
#  Welcome to TerminalJS. This is an introductory   #
#  text. It has some information to get started     #
#     ____                     ___                  #
#    / __/__ ______ _________ / _ \___  ___  __ _   #
#   _\ \/ -_) __/ // / __/ -_) , _/ _ \/ _ \/  ' \  #
#  /___/\__/\__/\_,_/_/  \__/_/|_|\___/\___/_/_/_/  #
#                                                   #
#####################################################
</pre-->
<b></b>
<b></b>
<script>
  (function (container) {
    var cursor = document.createElement("span"),
        term   = document.createElement("dl"),
        timer  = window.setInterval(toggleCursor, 600),
        line   = 0,
        pntr   = 0;

    cursor.classList.add("cursor");
    cursor.textContent = " ";

    window.addEventListener("keydown", control, true);
    window.addEventListener("keypress", write, true);
    window.addEventListener("focus", function(){ cursor.classList.remove("nofocus"); }, true);
    window.addEventListener("blur", function(){ cursor.classList.add("nofocus"); }, true);

    window.setInterval(function(){ document.getElementById('time').textContent = document.getElementById('time').textContent.substring(0, 1) + " " + new Date().toString().substring(16,24);}, 1000);

    container.appendChild(term);
    execute();

    function toggleCursor(highlight) {
      if (highlight || !cursor.classList.contains("highlight"))
        cursor.classList.add("highlight");
      else
        cursor.classList.remove("highlight");

      if (highlight) {
        window.clearInterval(timer);
        timer = window.setInterval(toggleCursor, 600);
      }
    }

    function resetCursor() {
      if (cursor.nextSibling) {
        if (!cursor.previousSibling) cursor.parentNode.insertBefore(document.createTextNode(""), cursor);

        cursor.previousSibling.textContent = cursor.previousSibling.textContent + cursor.textContent + cursor.nextSibling.textContent;
        cursor.nextSibling.remove();
        cursor.textContent = " ";
      }
    }

    function control(event) {
      toggleCursor(true);

      switch (event.which) {
        case 13:
          execute();
          event.preventDefault();
          break;
        case 8:
          moveLeft(true);
          break;
        case 46:
          moveRight(true);
          break;
        case 37:
          moveLeft();
          break;
        case 39:
          moveRight();
          break;
        case 38:
          if (pntr > 0) { 
            clearLine();
            cursor.parentNode.insertBefore(document.createTextNode(term.querySelectorAll(".stdin")[--pntr].textContent.trim()), cursor);
          }
          break;
        case 40:
          if (pntr < term.querySelectorAll(".stdin").length-1) {
            clearLine();
            cursor.parentNode.insertBefore(document.createTextNode(term.querySelectorAll(".stdin")[++pntr].textContent.trim()), cursor);
          }
          break;
        default:
          break;
      }
    }

    function write(event) {
      if (event.which < 32) return;
      if (!cursor.previousSibling) cursor.parentNode.insertBefore(document.createTextNode(""), cursor);
      cursor.previousSibling.textContent = cursor.previousSibling.textContent + String.fromCharCode(event.which);
    }

    function execute() {
      resetCursor();
      if (cursor.parentNode) {
        cursor.parentNode.previousSibling.id = "";
        if (cursor.parentNode.textContent == " ")
          return;
        else
          insertLine(eval(cursor.parentNode.textContent), "afterend");
      }

      var ctrl = document.createElement("dt"),
          next = document.createElement("dd");

      ctrl.id = "time";
      ctrl.textContent = line++ + " " + new Date().toString().substring(16,24);

      next.classList.add("stdin");
      next.appendChild(cursor);
      term.appendChild(ctrl);
      term.appendChild(next);
    
      pntr = term.querySelectorAll(".stdin").length-1;
    }

    function insertLine(data, position) {
      term.lastChild.insertAdjacentHTML(position, "<dt>" + line++ + " " + new Date().toString().substring(16,24) + "</dt><dd class='stdout'>" + data + "</dd>");
    }

    function clearLine() {
      if (cursor.previousSibling) cursor.previousSibling.remove();
      if (cursor.nextSibling) cursor.nextSibling.remove();
      cursor.textContent = " ";
    }

    function moveLeft(remove) {
      if (!cursor.previousSibling || cursor.previousSibling.textContent == "") return;
      if (!remove) {
        if (!cursor.nextSibling) cursor.parentNode.appendChild(document.createTextNode(""));
        cursor.nextSibling.textContent = cursor.textContent + cursor.nextSibling.textContent;
        cursor.textContent = cursor.previousSibling.textContent.substring(cursor.previousSibling.textContent.length - 1);
      }
      cursor.previousSibling.textContent = cursor.previousSibling.textContent.substring(0, cursor.previousSibling.textContent.length - 1);
    }

    function moveRight(remove) {
      if (!cursor.nextSibling || cursor.nextSibling.textContent == "") return;
      if (!remove) {
        if (!cursor.previousSibling) cursor.parentNode.insertBefore(document.createTextNode(""), cursor);
        cursor.previousSibling.textContent = cursor.previousSibling.textContent + cursor.textContent;
      }
      cursor.textContent = cursor.nextSibling.textContent.substring(0, 1);
      cursor.nextSibling.textContent = cursor.nextSibling.textContent.substring(1);
    }
  })(document.body);
</script>
</body>
</html>