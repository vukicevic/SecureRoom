<html>
<head>
  <meta charset="utf-8"> 
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>SecureRoom Terminal</title>
  <style>
  	* {
   		padding: 0;
  		margin: 0;
	  }
    body {
  		background-color: black;
  		color: #bcefe6;
  		font-family: monospace;
      padding: 10px;
      text-shadow: 0 0 3px #bcefe6;
  	}
  	ul {
		  width:100%;
		  list-style-type: none;
  	}
    dl {
      white-space: pre;
    }
    dt {
      float: left;
      clear: left;
    }
    dt:after {
      content: " # ";
    }
    dl {
      float: left;
    }
    span.line {
      display: inline-block;
      width: 2em;
      text-align: right;
      color: orange;
    }
    #cursor {
      height: 1em;
      width: 1em;
    }
    #cursor.highlight {
      background-color: #bcefe6;
      color: black;
      box-shadow: 0 0 3px #bcefe6;
    }
    #cursor.nofocus {
      background-color: transparent !important;
      color: #bcefe6 !important;
      box-shadow: 0 0 3px #bcefe6;
    }
  </style>
</head>
<body>
<!--pre>
#####################################################
#                                                   #
#  Welcome to TerminalJS. This is an introductory   #
#  text. It has some information to get started     #
#     ____                     ___                  #
#    / __/__ ______ _________ / _ \___  ___  __ _   #
#   _\ \/ -_) __/ // / __/ -_) , _/ _ \/ _ \/  ' \  #
#  /___/\__/\__/\_,_/_/  \__/_/|_|\___/\___/_/_/_/  #
#                                                   #
#####################################################
</pre-->
<b></b>
<b></b>
<script>
  function callback(text) {
    console.log(text);
  }

  var T = (function (container, callback) {
    var term   = document.createElement("dl"),
        line   = 0,
        pntr   = 0;

    window.addEventListener("keydown", control, true);
    window.addEventListener("keypress", write, true);
    window.addEventListener("focus", function(){ cursor.classList.remove("nofocus"); }, true);
    window.addEventListener("blur", function(){ cursor.classList.add("nofocus"); }, true);

    term.insertAdjacentHTML("afterbegin", "<dt id='input'><span class='line'></span> <span id='time'></span> </dt><dd class='stdin'><span id='cursor'> </span></dd>");
    container.appendChild(term);

    var cursor = document.getElementById("cursor"),
        clock = document.getElementById('time'),
        timer = window.setInterval(toggleCursor, 600);

    clock.date = new Date();
    clock.textContent = clock.date.toString().substring(16,24);
    window.setInterval(function(){ clock.date.setTime(Date.now()); clock.textContent = clock.date.toString().substring(16,24); }, 1000);

    function toggleCursor(highlight) {
      if (highlight || !cursor.classList.contains("highlight"))
        cursor.classList.add("highlight");
      else
        cursor.classList.remove("highlight");

      if (highlight) {
        window.clearInterval(timer);
        timer = window.setInterval(toggleCursor, 600);
      }
    }

    function resetCursor() {
      if (cursor.nextSibling) {
        if (!cursor.previousSibling) cursor.parentNode.insertBefore(document.createTextNode(""), cursor);

        cursor.previousSibling.textContent = cursor.previousSibling.textContent + cursor.textContent + cursor.nextSibling.textContent;
        cursor.nextSibling.remove();
        cursor.textContent = " ";
      }
    }

    function control(event) {
      toggleCursor(true);

      switch (event.which) {
        case 13:
          execute();
          event.preventDefault();
          break;
        case 8:
          moveLeft(true);
          break;
        case 46:
          moveRight(true);
          break;
        case 37:
          moveLeft();
          break;
        case 39:
          moveRight();
          break;
        case 38:
          if (pntr > 0) { 
            clearLine();
            cursor.parentNode.insertBefore(document.createTextNode(term.querySelectorAll("dd.stdin")[--pntr].textContent.trim()), cursor);
          }
          event.preventDefault();
          break;
        case 40:
          if (pntr < term.querySelectorAll("dd.stdin").length-1) {
            clearLine();
            cursor.parentNode.insertBefore(document.createTextNode(term.querySelectorAll("dd.stdin")[++pntr].textContent.trim()), cursor);
          }
          event.preventDefault();
          break;
        default:
          break;
      }
    }

    function write(event) {
      if (event.which < 32) return;
      if (!cursor.previousSibling) cursor.parentNode.insertBefore(document.createTextNode(""), cursor);
      cursor.previousSibling.textContent = cursor.previousSibling.textContent + String.fromCharCode(event.which);
    }

    function execute() {
      resetCursor();
      if (!cursor.parentNode || cursor.parentNode.textContent == " ") return;

      var text = cursor.parentNode.textContent;
      insertLine(line++, clock.textContent, "nenad", text, "in");
      clearLine();
      //insertLine(line++, clock.textContent, "eval", eval(text), "out");
      callback(text);
    
      pntr = term.querySelectorAll("dd.stdin").length-1;
    }

    function insertLine(line, time, name, data, type) {
      document.getElementById("input").insertAdjacentHTML("beforebegin", "<dt><span class='line'>"+line+"</span> <span>"+time+"</span> <span>"+name+"</span></dt><dd class='std"+type+"'>"+data+"</dd>");
    }

    function clearLine() {
      if (cursor.previousSibling) cursor.previousSibling.remove();
      if (cursor.nextSibling) cursor.nextSibling.remove();
      cursor.textContent = " ";
    }

    function moveLeft(remove) {
      if (!cursor.previousSibling || cursor.previousSibling.textContent == "") return;
      if (!remove) {
        if (!cursor.nextSibling) cursor.parentNode.appendChild(document.createTextNode(""));
        cursor.nextSibling.textContent = cursor.textContent + cursor.nextSibling.textContent;
        cursor.textContent = cursor.previousSibling.textContent.substring(cursor.previousSibling.textContent.length - 1);
      }
      cursor.previousSibling.textContent = cursor.previousSibling.textContent.substring(0, cursor.previousSibling.textContent.length - 1);
    }

    function moveRight(remove) {
      if (!cursor.nextSibling || cursor.nextSibling.textContent == "") return;
      if (!remove) {
        if (!cursor.previousSibling) cursor.parentNode.insertBefore(document.createTextNode(""), cursor);
        cursor.previousSibling.textContent = cursor.previousSibling.textContent + cursor.textContent;
      }
      cursor.textContent = cursor.nextSibling.textContent.substring(0, 1);
      cursor.nextSibling.textContent = cursor.nextSibling.textContent.substring(1);
    }

    return function(name, data) {
      insertLine(line++, clock.textContent, name, data, "out");
    };
  })(document.body, callback);
</script>
</body>
</html>